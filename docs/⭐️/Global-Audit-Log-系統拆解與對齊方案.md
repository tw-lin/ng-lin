# Global Audit Log ç³»çµ±æ‹†è§£èˆ‡å°é½Šæ–¹æ¡ˆ

> **æ–‡ä»¶ç‰ˆæœ¬**: v1.0.0  
> **å»ºç«‹æ—¥æœŸ**: 2025-12-25  
> **è§’è‰²å®šä½**: GitHub & Firebase Platform Omniscient â€“ Architecture & Interaction Focus  
> **è¨­è¨ˆåŸºæº–**: 
> - docs/â­ï¸/Global Audit Log.md  
> - docs/â­ï¸/Global-Audit-Log-ç³»çµ±æ‹“æ’²åˆ†æèˆ‡å¯¦æ–½è·¯å¾‘.md  
> - docs/â­ï¸/Globalå…¨åŸŸç³»çµ±äº¤äº’æ‹“æ’².md  
> **è§’è‰²é‚Šç•Œ**: docs/â­ï¸/â­ï¸ROLE-CODE.md

---

## ğŸ“‹ æ–‡ä»¶ç›®çš„

åŸºæ–¼ **â­ï¸ROLE-CODE.md** æ‰€å®šç¾©ä¹‹è§’è‰²é‚Šç•Œï¼Œæ•´åˆä¸‰ä»½è¨­è¨ˆåŸºæº–æ–‡ä»¶ï¼Œå¾ç³»çµ±æ¶æ§‹èˆ‡è·¨æ¨¡çµ„äº¤äº’çš„è§’åº¦ï¼Œæå‡º **Global Audit Log** ç³»çµ±çš„å®Œæ•´æ‹†è§£ã€å°é½Šèˆ‡è½å¯¦æ–¹æ¡ˆã€‚

**æ ¸å¿ƒèšç„¦**ï¼š
1. æ ¸å¿ƒå­ç³»çµ±ä¹‹é–“çš„äº¤äº’æ‹“æ’²å®Œæ•´æ€§èˆ‡ä¸€è‡´æ€§åˆ†æ
2. Audit ä½œç‚ºæ©«åˆ‡é—œæ³¨é»å¦‚ä½•è²«ç©¿æ•´é«”ç³»çµ±
3. ç¾æœ‰å¯¦æ–½èˆ‡è¨­è¨ˆæ‹“æ’²ä¹‹é–“çš„è½å·®èˆ‡ä¿®æ­£æ–¹å‘
4. å¯åŸ·è¡Œã€å¯ç¶­è­·ã€å¯æ“´å±•çš„å¯¦éš›ç³»çµ±çµæ§‹

**æ˜ç¢ºæ’é™¤**ï¼šç¨‹å¼ç¢¼å±¤ç´šæˆ–æ¡†æ¶å¯¦ä½œç´°ç¯€

---

## ğŸ¯ Part I: ç³»çµ±å®šä½èˆ‡è§’è‰²é‚Šç•Œ

### 1.1 è§’è‰²é‚Šç•Œé‡ç”³ (Role Boundaries)

æ ¹æ“š **â­ï¸ROLE-CODE.md**ï¼Œæœ¬æ–‡ä»¶å°ˆæ³¨æ–¼ï¼š

**âœ… Architecture & Interaction å±¤é¢**ï¼š
- ç³»çµ±æ¶æ§‹ç†è§£ï¼ˆæ ¸å¿ƒæ¨¡çµ„ã€ä¾è³´é—œä¿‚ã€é ˜åŸŸé‚Šç•Œï¼‰
- è·¨ç³»çµ±/æœå‹™äº’å‹•åˆ†æï¼ˆäº‹ä»¶æµã€ä¾è³´éˆã€å”ä½œæ¨¡å¼ï¼‰
- ä½¿ç”¨è€…èˆ‡ç³»çµ±äº¤äº’æ¨¡å¼ï¼ˆæ±ºç­–é»ã€æ“ä½œæµç¨‹ã€ç“¶é ¸è­˜åˆ¥ï¼‰
- æ¦‚å¿µåŒ–åˆ†æèˆ‡ç­–ç•¥ï¼ˆé«˜å±¤æŠ½è±¡ã€è¨­è¨ˆé‚è¼¯ã€ç­–ç•¥æ´å¯Ÿï¼‰

**âŒ æ˜ç¢ºæ’é™¤**ï¼š
- TypeScript/Angular/Firebase SDK å¯¦ä½œç´°ç¯€
- Signals/Decorators API ä½¿ç”¨æ–¹å¼
- Firestore Collection Schema å®šç¾©
- å…·é«”å‡½æ•¸ç°½åèˆ‡é¡åˆ¥å¯¦ä½œ

### 1.2 Global Audit Log ç³»çµ±æœ¬è³ª

**å®šä½**ï¼šæ©«åˆ‡é—œæ³¨é» (Cross-Cutting Concern) + åŸºç¤è¨­æ–½æœå‹™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ç³»çµ±å±¤ç´šå®šä½ (3-Tier Architecture)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Business Layer]                                       â”‚
â”‚  - Repository / Issue / PR / Organization / Team       â”‚
â”‚  - ç™¼å‡ºé ˜åŸŸäº‹ä»¶ï¼Œä¸æ„ŸçŸ¥ Audit å­˜åœ¨                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Cross-Cutting Layer] â† Audit Log ä½æ–¼æ­¤å±¤             â”‚
â”‚  - Global Audit Log (åˆè¦æ€§ã€å®‰å…¨æ€§ã€å¯è¿½æº¯æ€§)          â”‚
â”‚  - Notification System (å‘Šè­¦ã€é€šçŸ¥)                     â”‚
â”‚  - Rate Limiting (æµé‡æ§åˆ¶)                             â”‚
â”‚  - Analytics (æ•¸æ“šèšåˆ)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Infrastructure Layer]                                 â”‚
â”‚  - Event Bus (äº‹ä»¶åˆ†ç™¼ä¸­å¿ƒ)                            â”‚
â”‚  - Identity & Auth (èº«ä»½æˆæ¬Š)                          â”‚
â”‚  - Storage (Firestore/RTDB)                            â”‚
â”‚  - Search (å…¨æ–‡æª¢ç´¢)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- **éç¨ç«‹æ¥­å‹™æ¨¡çµ„**ï¼šä¸æä¾›ç›´æ¥æ¥­å‹™åƒ¹å€¼çµ¦çµ‚ç«¯ä½¿ç”¨è€…
- **è§€å¯Ÿæ€§ç³»çµ±**ï¼šä¸æ”¹è®Šæ¥­å‹™é‚è¼¯æµç¨‹ï¼Œåƒ…è¨˜éŒ„èˆ‡ç›£æ§
- **è¢«å‹•ä¾è³´**ï¼šä¾è³´ Event Busï¼Œä½† Business Layer ä¸ä¾è³´ Audit

---

## ğŸ”„ Part II: æ ¸å¿ƒç³»çµ±äº¤äº’æ‹“æ’²å°é½Š

### 2.1 æ‹“æ’²å±¤ç´šåˆ†è§£ (8-Layer Topology)

åŸºæ–¼ **Global-Audit-Log-ç³»çµ±æ‹“æ’²åˆ†æèˆ‡å¯¦æ–½è·¯å¾‘.md**ï¼Œå®Œæ•´æ‹“æ’²åŒ…å« 8 å€‹è™•ç†å±¤ç´šï¼š

```
Layer 1: [Event Source] (æ¥­å‹™æ¨¡çµ„)
    â†“ ç™¼å‡ºé ˜åŸŸäº‹ä»¶
Layer 2: [Event Bus] (äº‹ä»¶åˆ†ç™¼ä¸­å¿ƒ)
    â†“ ç§Ÿæˆ¶æ„ŸçŸ¥è·¯ç”±
Layer 3: [Audit Collector] (äº‹ä»¶æ”å–å±¤)
    â†“ è¨‚é–±éæ¿¾
Layer 4: [Classification Engine] (åˆ†é¡è™•ç†å±¤)
    â”œâ”€â†’ [Level Classifier] â†’ INFO/WARNING/ERROR/CRITICAL
    â”œâ”€â†’ [Category Analyzer] â†’ 8 categories
    â””â”€â†’ [Metadata Extractor] â†’ Actor/Resource/Tenant/IP/Timestamp
    â†“ æ¨™æº–åŒ–
Layer 5: [Audit Store] (å„²å­˜å±¤)
    â”œâ”€â†’ [Hot Tier] â†’ In-Memory/Redis (24h)
    â”œâ”€â†’ [Warm Tier] â†’ Firestore (90d)
    â””â”€â†’ [Cold Tier] â†’ Cloud Storage (7y)
    â†“ æŒä¹…åŒ–
Layer 6: [Query Service] (æŸ¥è©¢æœå‹™å±¤)
    â”œâ”€â†’ [Tenant Isolation] â†’ è‡ªå‹•éæ¿¾
    â”œâ”€â†’ [Multi-dimension Filter] â†’ æ™‚é–“/é¡åˆ¥/ç´šåˆ¥/Actor/Resource
    â””â”€â†’ [Pagination] â†’ å¤§é‡è³‡æ–™åˆ†é 
    â†“ çµæœè¿”å›
Layer 7: [Export Service] (å°å‡ºæœå‹™å±¤)
    â”œâ”€â†’ [JSON Export] â†’ ç¨‹å¼åŒ–è™•ç†
    â”œâ”€â†’ [CSV Export] â†’ è¡¨æ ¼åˆ†æ
    â””â”€â†’ [PDF Report] â†’ åˆè¦æ­¸æª”
    â†“ å ±å‘Šç”Ÿæˆ
Layer 8: [Review Workflow] (å¯©æŸ¥å·¥ä½œæµå±¤)
    â”œâ”€â†’ [requiresReview Flag] â†’ é«˜é¢¨éšªæ“ä½œè‡ªå‹•æ¨™è¨˜
    â”œâ”€â†’ [Reviewer Assignment] â†’ æŒ‡æ´¾å¯©æŸ¥è€…
    â””â”€â†’ [Review Decision Tracking] â†’ è¨˜éŒ„å¯©æŸ¥çµæœ
```

### 2.2 é—œéµäº¤äº’ç¯€é»è©³è§£

#### Node A: Event Bus â†’ Audit Collector (äº‹ä»¶æ”å–)

**äº¤äº’æ¨¡å¼**: è§€å¯Ÿè€…æ¨¡å¼ (Observer Pattern)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Event Bus (æ ¸å¿ƒ)                    â”‚
â”‚  - çµ±ä¸€äº‹ä»¶åˆ†ç™¼ä¸­å¿ƒ                                   â”‚
â”‚  - ç§Ÿæˆ¶æ„ŸçŸ¥è·¯ç”± (tenant_id routing)                  â”‚
â”‚  - ä¿è­‰äº‹ä»¶é †åºæ€§ (per tenant)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ ç™¼å¸ƒäº‹ä»¶
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Audit Collector (è¨‚é–±è€…)                    â”‚
â”‚  - è¨‚é–±é—œéµäº‹ä»¶é¡å‹ (auth.*, repo.*, issue.*)        â”‚
â”‚  - ä¸å¹²é äº‹ä»¶æµï¼Œåƒ…è¢«å‹•ç›£è½                           â”‚
â”‚  - æ”¯æ´äº‹ä»¶éæ¿¾ (åƒ…è¨˜éŒ„é—œéµæ“ä½œ)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¾è³´é—œä¿‚**ï¼š
```
Audit Collector â”€â”€â”€â”€å–®å‘ä¾è³´â”€â”€â”€â†’ Event Bus (è¨‚é–±äº‹ä»¶)
Audit Collector â†â”€â”€å®Œå…¨è§£è€¦â”€â”€â”€â”€â”¤ Business Modules (æ¥­å‹™ä¸çŸ¥é“ Audit å­˜åœ¨)
```

**è¨­è¨ˆåŸå‰‡é©—è­‰**ï¼š
- âœ… **å–®å‘ä¾è³´**: Audit ä¾è³´ Event Busï¼ŒBusiness Modules ä¸çŸ¥é“ Audit å­˜åœ¨
- âœ… **ä½è€¦åˆ**: æ–°å¢/ç§»é™¤å¯©è¨ˆä¸å½±éŸ¿æ¥­å‹™é‚è¼¯
- âœ… **é«˜å…§èš**: Audit ç›¸é—œé‚è¼¯é›†ä¸­åœ¨ Collector

#### Node B: Audit Collector â†’ Classification (åˆ†é¡è™•ç†)

**è™•ç†æµç¨‹**ï¼š

```
åŸå§‹é ˜åŸŸäº‹ä»¶ (Domain Event)
    â†“
[Step 1: äº‹ä»¶é¡å‹è­˜åˆ¥]
    â”œâ”€â†’ auth.* â†’ AUTHENTICATION/AUTHORIZATION
    â”œâ”€â†’ repo.* â†’ DATA_MODIFICATION
    â”œâ”€â†’ config.* â†’ SYSTEM_CONFIGURATION
    â””â”€â†’ security.* â†’ SECURITY
    â†“
[Step 2: å½±éŸ¿ç´šåˆ¥åˆ¤å®š]
    â”œâ”€â†’ æˆåŠŸæ“ä½œ â†’ INFO
    â”œâ”€â†’ éœ€é—œæ³¨ä½†ä¸å½±éŸ¿ç³»çµ± â†’ WARNING
    â”œâ”€â†’ æ“ä½œå¤±æ•—æˆ–ç•°å¸¸ â†’ ERROR
    â””â”€â†’ å®‰å…¨å¨è„…æˆ–é‡å¤§å½±éŸ¿ â†’ CRITICAL
    â†“
[Step 3: å…ƒæ•¸æ“šèƒå–]
    â”œâ”€â†’ Actor (åŸ·è¡Œè€… user_id/service_account)
    â”œâ”€â†’ Resource (ç›®æ¨™è³‡æº repo_id/issue_id)
    â”œâ”€â†’ Tenant (ç§Ÿæˆ¶ org_id/user_id)
    â”œâ”€â†’ IP Address (ä¾†æº IP)
    â”œâ”€â†’ User Agent (å®¢æˆ¶ç«¯è³‡è¨Š)
    â””â”€â†’ Timestamp (äº‹ä»¶æ™‚é–“)
    â†“
[Step 4: è®Šæ›´è¿½è¹¤ (å¯é¸)]
    â”œâ”€â†’ Before (è®Šæ›´å‰ç‹€æ…‹)
    â””â”€â†’ After (è®Šæ›´å¾Œç‹€æ…‹)
    â†“
æ¨™æº–åŒ–å¯©è¨ˆäº‹ä»¶ (Standardized Audit Event)
```

**åˆ†é¡è¦å‰‡æŠ½è±¡å®šç¾©**ï¼š

| Category | äº‹ä»¶é¡å‹ç¯„ä¾‹ | ç´šåˆ¥åˆ¤å®šé‚è¼¯ |
|----------|-------------|-------------|
| **AUTHENTICATION** | login, logout, password_change, mfa_enable | æˆåŠŸ=INFO, å¤±æ•—=WARNING, ç•°å¸¸=CRITICAL |
| **AUTHORIZATION** | permission_grant, role_assign, access_check | æˆäºˆ=INFO, æ‹’çµ•=WARNING, ç•°å¸¸=CRITICAL |
| **DATA_ACCESS** | read, query, search | æ­£å¸¸=INFO, ç•°å¸¸å­˜å–=WARNING |
| **DATA_MODIFICATION** | create, update, delete | æˆåŠŸ=INFO, å¤±æ•—=ERROR, æ•æ„Ÿè³‡æ–™=WARNING |
| **SECURITY** | threat_detected, policy_violation, anomaly | ä½é¢¨éšª=WARNING, é«˜é¢¨éšª=CRITICAL |
| **SYSTEM_CONFIGURATION** | settings_change, feature_toggle | æˆåŠŸ=INFO, å¤±æ•—=ERROR, ç ´å£æ€§=WARNING |
| **COMPLIANCE** | gdpr_export, audit_access, retention_policy | ç¬¦åˆ=INFO, é•è¦=CRITICAL |
| **BUSINESS_OPERATION** | workflow_execution, scheduled_task | æˆåŠŸ=INFO, å¤±æ•—=ERROR |

#### Node C: Audit Store â†’ Query/Export (è³‡æ–™æœå‹™)

**æœå‹™æ¨¡å¼åˆ†å±¤**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Query Service (æŸ¥è©¢æœå‹™å±¤)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [æŸ¥è©¢ç¶­åº¦]                                           â”‚
â”‚  â”œâ”€â”€ æ™‚é–“ç¯„åœ (timestamp range)                     â”‚
â”‚  â”œâ”€â”€ é¡åˆ¥éæ¿¾ (category filter)                     â”‚
â”‚  â”œâ”€â”€ ç´šåˆ¥éæ¿¾ (level filter)                        â”‚
â”‚  â”œâ”€â”€ åŸ·è¡Œè€…æŸ¥è©¢ (actor filter)                      â”‚
â”‚  â”œâ”€â”€ è³‡æºæŸ¥è©¢ (resource filter)                     â”‚
â”‚  â””â”€â”€ ç§Ÿæˆ¶éš”é›¢ (tenant isolation - è‡ªå‹•æ³¨å…¥)         â”‚
â”‚                                                     â”‚
â”‚ [æŸ¥è©¢å„ªåŒ–]                                           â”‚
â”‚  â”œâ”€â”€ ç´¢å¼•ç­–ç•¥ (timestamp, tenant_id, category)     â”‚
â”‚  â”œâ”€â”€ åˆ†é æ©Ÿåˆ¶ (cursor-based pagination)            â”‚
â”‚  â””â”€â”€ å¿«å–ç­–ç•¥ (hot data in-memory)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Export Service (å°å‡ºæœå‹™å±¤)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [JSON Export]                                       â”‚
â”‚  - ç”¨é€”: ç¨‹å¼åŒ–è™•ç†ã€ç³»çµ±æ•´åˆ                        â”‚
â”‚  - æ ¼å¼: çµæ§‹åŒ– JSON é™£åˆ—                           â”‚
â”‚                                                     â”‚
â”‚ [CSV Export]                                        â”‚
â”‚  - ç”¨é€”: Excel åˆ†æã€BI å·¥å…·                        â”‚
â”‚  - æ ¼å¼: è¡¨æ ¼å¼ï¼ŒåŒ…å«æ‰€æœ‰æ¬„ä½                        â”‚
â”‚                                                     â”‚
â”‚ [PDF Report]                                        â”‚
â”‚  - ç”¨é€”: åˆè¦æ­¸æª”ã€ç®¡ç†å ±å‘Š                         â”‚
â”‚  - æ ¼å¼: æ­£å¼å ±å‘Šæ¨¡æ¿ï¼ŒåŒ…å«çµ±è¨ˆåœ–è¡¨                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Review Workflow (å¯©æŸ¥å·¥ä½œæµå±¤)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [è‡ªå‹•æ¨™è¨˜]                                           â”‚
â”‚  â”œâ”€â”€ requiresReview Flag (é«˜é¢¨éšªæ“ä½œè‡ªå‹•æ¨™è¨˜)       â”‚
â”‚  â””â”€â”€ è§¸ç™¼æ¢ä»¶: CRITICAL level, SECURITY category    â”‚
â”‚                                                     â”‚
â”‚ [å¯©æŸ¥æµç¨‹]                                           â”‚
â”‚  â”œâ”€â”€ é€šçŸ¥å¯©æŸ¥è€… (Notification Service æ•´åˆ)         â”‚
â”‚  â”œâ”€â”€ å¯©æŸ¥è€…æª¢è¦– (Audit Viewer UI)                  â”‚
â”‚  â””â”€â”€ æ±ºç­–è¨˜éŒ„ (reviewed_at, reviewed_by, notes)    â”‚
â”‚                                                     â”‚
â”‚ [æ±ºç­–é¡å‹]                                           â”‚
â”‚  â”œâ”€â”€ Approve â†’ æ¨™è¨˜ç‚ºå·²å¯©æŸ¥                         â”‚
â”‚  â”œâ”€â”€ Investigate â†’ å»ºç«‹èª¿æŸ¥å·¥å–®                     â”‚
â”‚  â””â”€â”€ Escalate â†’ å‡ç´šåˆ°é«˜å±¤ç®¡ç†                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æ‹“æ’²å®Œæ•´æ€§é©—è­‰

æ ¹æ“š **Globalå…¨åŸŸç³»çµ±äº¤äº’æ‹“æ’².md** çš„å…¨åŸŸè¦–è§’ï¼Œé©—è­‰ Audit Log æ‹“æ’²æ˜¯å¦å®Œæ•´ï¼š

**âœ… å·²å°é½Šçš„å…¨åŸŸç³»çµ±äº¤äº’**ï¼š

```
[Event Bus] â†â”€â”€â”€â”€â”€æ•´åˆâ”€â”€â”€â”€â†’ [Audit Log Collector]
    â†“                              â†“
[Identity & Auth] â”€â”€æä¾›åŸ·è¡Œè€…èº«ä»½â”€â†’ [Actor Extraction]
    â†“                              â†“
[Notification] â†â”€â”€å‘Šè­¦è§¸ç™¼â”€â”€â”€â”€â”€â”€ [Critical Event Detection]
    â†“                              â†“
[Search] â†â”€â”€â”€â”€ç´¢å¼•åŒæ­¥â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [Audit Event Indexing]
```

**âš ï¸ å°šæœªå®Œæ•´å°é½Šçš„å…¨åŸŸç³»çµ±äº¤äº’**ï¼š

```
[Rate Limiting] â†â”€æœªæ•´åˆâ”€ [Audit Log] (æ‡‰è¨˜éŒ„é™æµäº‹ä»¶)
[Billing] â†â”€æœªæ•´åˆâ”€ [Audit Log] (æ‡‰è¨˜éŒ„è¨ˆè²»æ“ä½œ)
[Webhooks] â†â”€æœªæ•´åˆâ”€ [Audit Log] (æ‡‰è¨˜éŒ„ webhook è§¸ç™¼)
[Actions] â†â”€æœªæ•´åˆâ”€ [Audit Log] (æ‡‰è¨˜éŒ„ CI/CD æ“ä½œ)
[Security Scanning] â†â”€æœªæ•´åˆâ”€ [Audit Log] (æ‡‰è¨˜éŒ„æƒæçµæœ)
```

---

## ğŸ—ï¸ Part III: Audit æ©«åˆ‡é—œæ³¨é»è²«ç©¿ç­–ç•¥

### 3.1 æ©«åˆ‡é»æ³¨å…¥æ–¹å¼å®Œæ•´åˆ†æ

#### æ–¹å¼ A: äº‹ä»¶é©…å‹• (Event-Driven) âœ… **æ¨è–¦ (P0)**

**æ¶æ§‹æ¨¡å¼**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Business Module (æ¥­å‹™æ¨¡çµ„)               â”‚
â”‚  - åŸ·è¡Œæ¥­å‹™é‚è¼¯ (create/update/delete)                â”‚
â”‚  - ç™¼å‡ºé ˜åŸŸäº‹ä»¶ (repo.created, issue.closed)         â”‚
â”‚  - ä¸æ„ŸçŸ¥ Audit å­˜åœ¨                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ publish event
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Event Bus (ä¸­ä»‹å±¤)                   â”‚
â”‚  - æ¥æ”¶æ‰€æœ‰é ˜åŸŸäº‹ä»¶                                   â”‚
â”‚  - ç§Ÿæˆ¶æ„ŸçŸ¥è·¯ç”±                                       â”‚
â”‚  - äº‹ä»¶æŒä¹…åŒ– (å¯é¸ï¼Œæ”¯æ´äº‹ä»¶é‡æ’­)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ subscribe
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Audit Collector (æ©«åˆ‡æ³¨å…¥é»)                 â”‚
â”‚  - è¨‚é–±æ‰€æœ‰é—œéµäº‹ä»¶é¡å‹                               â”‚
â”‚  - è‡ªå‹•åˆ†é¡èˆ‡è¨˜éŒ„                                     â”‚
â”‚  - å®Œå…¨è§£è€¦æ¥­å‹™é‚è¼¯                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å„ªé»**ï¼š
- âœ… å®Œå…¨è§£è€¦æ¥­å‹™é‚è¼¯èˆ‡å¯©è¨ˆé‚è¼¯
- âœ… æ¥­å‹™æ¨¡çµ„ç„¡éœ€ä¿®æ”¹ç¨‹å¼ç¢¼å³å¯å•Ÿç”¨/åœç”¨å¯©è¨ˆ
- âœ… æ”¯æ´äº‹ä»¶é‡æ’­èˆ‡è£œéŒ„ï¼ˆåˆè¦è¦æ±‚ï¼‰
- âœ… æ˜“æ–¼æ–°å¢å¯©è¨ˆè¦å‰‡ï¼ˆåªéœ€èª¿æ•´è¨‚é–±ï¼‰
- âœ… ç¬¦åˆ GitHub å…¨åŸŸç³»çµ±è¨­è¨ˆåŸå‰‡ï¼ˆè§£è€¦ã€ç§Ÿæˆ¶æ„ŸçŸ¥ã€å¯æ“´å±•ï¼‰

**é©ç”¨å ´æ™¯**ï¼š
- æ‰€æœ‰é ˜åŸŸäº‹ä»¶ (Domain Events)
- è·¨æ¨¡çµ„å”ä½œäº‹ä»¶
- ç³»çµ±ç´šäº‹ä»¶ (config changes, system events)

**å¯¦æ–½è¦é»**ï¼š
1. Event Bus æˆç‚ºå¿…è¦ä¾è³´ï¼ˆå·²å®Œæˆ Phase 1-6ï¼‰
2. æ‰€æœ‰æ¥­å‹™æ¨¡çµ„å¿…é ˆç™¼å‡ºæ¨™æº–åŒ–é ˜åŸŸäº‹ä»¶
3. Audit Collector è¨‚é–± `*` (å…¨åŸŸè¨‚é–±) æˆ–ç‰¹å®šæ¨¡å¼ (auth.*, repo.*)

#### æ–¹å¼ B: æ–¹æ³•è£é£¾å™¨ (Method Decorator) âš ï¸ **è£œå……ä½¿ç”¨ (P2)**

**æ¶æ§‹æ¨¡å¼**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Business Service (æ¥­å‹™æœå‹™)              â”‚
â”‚                                                      â”‚
â”‚  @Auditable({ category: 'DATA_MODIFICATION' })      â”‚
â”‚  async deleteRepository(id: string): Promise<void> { â”‚
â”‚    // æ¥­å‹™é‚è¼¯                                        â”‚
â”‚    // è£é£¾å™¨è‡ªå‹•è¨˜éŒ„æ–¹æ³•åŸ·è¡Œ                          â”‚
â”‚  }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å„ªé»**ï¼š
- âœ… ç´°ç²’åº¦æ§åˆ¶ï¼ˆæ–¹æ³•ç´šåˆ¥ï¼‰
- âœ… å¯æ”œå¸¶æ–¹æ³•åƒæ•¸èˆ‡è¿”å›å€¼
- âœ… é©åˆç„¡æ³•ç™¼å‡ºäº‹ä»¶çš„æ“ä½œï¼ˆè¨ˆç®—å‹æ–¹æ³•ï¼‰

**ç¼ºé»**ï¼š
- âŒ è€¦åˆæ–¼å¯¦ä½œç´°ç¯€ï¼ˆéœ€ä¿®æ”¹ç¨‹å¼ç¢¼ï¼‰
- âŒ è£é£¾å™¨æ•£ä½ˆæ–¼å„è™•ï¼ˆç¶­è­·æˆæœ¬é«˜ï¼‰
- âŒ ç„¡æ³•è¿½è¹¤è·¨æœå‹™æ“ä½œ

**é©ç”¨å ´æ™¯**ï¼š
- éäº‹ä»¶é©…å‹•çš„æ“ä½œï¼ˆè¨ˆç®—å‹æ–¹æ³•ï¼‰
- éœ€è¦è¨˜éŒ„åƒæ•¸/è¿”å›å€¼çš„å ´æ™¯
- ç¬¬ä¸‰æ–¹æœå‹™å‘¼å«ï¼ˆç„¡æ³•ç™¼å‡ºé ˜åŸŸäº‹ä»¶ï¼‰

**å¯¦æ–½é™åˆ¶**ï¼š
- åƒ…ä½œç‚ºäº‹ä»¶é©…å‹•çš„è£œå……
- ä¸æ‡‰æˆç‚ºä¸»è¦å¯©è¨ˆæ–¹å¼
- å¿…é ˆæ˜ç¢ºæ–‡æª”åŒ–ä½¿ç”¨ä½ç½®

#### æ–¹å¼ C: HTTP Interceptor âš ï¸ **ç‰¹å®šå ´æ™¯ (P1)**

**æ¶æ§‹æ¨¡å¼**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              API Gateway / HTTP Layer                â”‚
â”‚                                                      â”‚
â”‚  [HTTP Request] â†’ [Interceptor] â†’ [Backend Service] â”‚
â”‚                        â†“                             â”‚
â”‚                   Audit Record                       â”‚
â”‚                   (API call log)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å„ªé»**ï¼š
- âœ… é›†ä¸­è™•ç† HTTP è«‹æ±‚å¯©è¨ˆ
- âœ… ç„¡éœ€ä¿®æ”¹æ¥­å‹™ç¨‹å¼ç¢¼
- âœ… è‡ªå‹•è¨˜éŒ„ HTTP å±¤è³‡è¨Šï¼ˆIP, User Agent, Headersï¼‰

**ç¼ºé»**ï¼š
- âŒ åƒ…é™ HTTP å±¤æ“ä½œ
- âŒ ç„¡æ³•è¿½è¹¤å…§éƒ¨é‚è¼¯
- âŒ ç„¡æ³•è¨˜éŒ„æ¥­å‹™ç´šåˆ¥è³‡è¨Š

**é©ç”¨å ´æ™¯**ï¼š
- API å‘¼å«è¨˜éŒ„ï¼ˆExternal API æ•´åˆï¼‰
- å¤–éƒ¨ç³»çµ±æ•´åˆï¼ˆWebhooks è§¸ç™¼ï¼‰
- HTTP å±¤å®‰å…¨å¯©è¨ˆï¼ˆSQL Injection æª¢æ¸¬ï¼‰

### 3.2 æ··åˆç­–ç•¥çŸ©é™£ (Hybrid Strategy Matrix)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Audit æ³¨å…¥ç­–ç•¥æ±ºç­–çŸ©é™£                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ“ä½œé¡å‹                â”‚ æ¨è–¦æ–¹å¼          â”‚ å„ªå…ˆç´š â”‚ è¦†è“‹ç‡ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é ˜åŸŸäº‹ä»¶ (CRUD)         â”‚ Event-Driven     â”‚ P0    â”‚ 100%  â”‚
â”‚ èªè­‰/æˆæ¬Šæ“ä½œ           â”‚ Event-Driven     â”‚ P0    â”‚ 100%  â”‚
â”‚ ç³»çµ±é…ç½®è®Šæ›´            â”‚ Event-Driven     â”‚ P0    â”‚ 100%  â”‚
â”‚ è·¨æ¨¡çµ„å”ä½œ              â”‚ Event-Driven     â”‚ P0    â”‚ 100%  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¤–éƒ¨ API å‘¼å«           â”‚ Interceptor      â”‚ P1    â”‚ 80%   â”‚
â”‚ Webhook è§¸ç™¼            â”‚ Interceptor      â”‚ P1    â”‚ 80%   â”‚
â”‚ ç¬¬ä¸‰æ–¹æœå‹™æ•´åˆ          â”‚ Interceptor      â”‚ P1    â”‚ 80%   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¨ˆç®—å‹æ–¹æ³• (ç„¡äº‹ä»¶)     â”‚ Decorator        â”‚ P2    â”‚ 50%   â”‚
â”‚ æ‰¹æ¬¡æ“ä½œ                â”‚ Manual Logging   â”‚ P2    â”‚ 40%   â”‚
â”‚ å…§éƒ¨å·¥å…·å‡½æ•¸            â”‚ ä¸å¯©è¨ˆ           â”‚ -     â”‚ 0%    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¨è–¦å¯¦æ–½é †åº**ï¼š
1. **Phase 1 (P0)**: Event-Driven ç‚ºä¸»ï¼Œè¦†è“‹æ‰€æœ‰é ˜åŸŸäº‹ä»¶
2. **Phase 2 (P1)**: Interceptor è£œå……ï¼Œè¦†è“‹ HTTP å±¤æ“ä½œ
3. **Phase 3 (P2)**: Decorator è£œå……ï¼Œè¦†è“‹ç‰¹å®šæ–¹æ³•

---

## ğŸ” Part IV: å¯¦æ–½è½å·®èˆ‡å°é½Šæ–¹æ¡ˆ

### 4.1 ç•¶å‰å¯¦æ–½ç‹€æ…‹è©•ä¼°

åŸºæ–¼ Phase 7A + 7B å®Œæˆç‹€æ…‹ï¼Œå®Œæ•´è©•ä¼°ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            å¯¦æ–½å®Œæˆåº¦çŸ©é™£ (12 ç¶­åº¦)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¶­åº¦                â”‚ å®Œæˆåº¦ â”‚ ç‹€æ…‹æè¿°              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. æ ¸å¿ƒæ¨¡å‹          â”‚ 100%  â”‚ âœ… AuditEvent å®Œæ•´   â”‚
â”‚ 2. åˆ†é¡è¦å‰‡          â”‚ 100%  â”‚ âœ… 8 categories/4 levels â”‚
â”‚ 3. å…ƒæ•¸æ“šæå–        â”‚ 90%   â”‚ âš ï¸ IP/UserAgent é¸æ“‡æ€§ â”‚
â”‚ 4. äº‹ä»¶æ”å–          â”‚ 40%   â”‚ âš ï¸ åƒ… Auth, ç¼º Repo/Issue/PR â”‚
â”‚ 5. è‡ªå‹•è¨‚é–±          â”‚ 30%   â”‚ âš ï¸ æ‰‹å‹•å‘¼å«ç‚ºä¸»       â”‚
â”‚ 6. å„²å­˜å±¤            â”‚ 50%   â”‚ âš ï¸ In-Memory, ç¼º Firestore â”‚
â”‚ 7. ç§Ÿæˆ¶éš”é›¢          â”‚ 40%   â”‚ âš ï¸ æ¨¡å‹æ”¯æ´, ç¼ºæŸ¥è©¢å±¤å¼·åˆ¶ â”‚
â”‚ 8. æŸ¥è©¢ API          â”‚ 70%   â”‚ âœ… åŸºæœ¬æŸ¥è©¢, ç¼ºé€²éšéæ¿¾ â”‚
â”‚ 9. å°å‡ºåŠŸèƒ½          â”‚ 60%   â”‚ âœ… JSON, ç¼º CSV/PDF â”‚
â”‚ 10. å¯©æŸ¥å·¥ä½œæµ       â”‚ 50%   â”‚ âœ… æ¨™è¨˜, ç¼ºå®Œæ•´æµç¨‹  â”‚
â”‚ 11. å‘Šè­¦æ•´åˆ         â”‚ 0%    â”‚ âŒ æœªæ•´åˆ Notification â”‚
â”‚ 12. æ¬Šé™æ•´åˆ         â”‚ 0%    â”‚ âŒ æœªè¿½è¹¤æˆæ¬Šæ±ºç­–     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•´é«”å®Œæˆåº¦           â”‚ 48%   â”‚ åŸºç¤å»ºç«‹, éœ€è£œå¼·æ•´åˆ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ‹“æ’²ç¼ºå£è©³ç´°åˆ†æ

#### ç¼ºå£ 1: Event Bus â†’ Audit Collector è‡ªå‹•è¨‚é–±æ©Ÿåˆ¶

**ç¾ç‹€æ‹“æ’²**ï¼š
```
Auth Event Consumer (æ‰‹å‹•å‘¼å«)
    â†“ æ˜ç¢ºå‘¼å« AuditService.recordEvent()
Auth Audit Service
    â†“ æ˜ç¢ºå‘¼å« AuditCollector.recordAuth()
Audit Collector
```

**ç†æƒ³æ‹“æ’²**ï¼š
```
Event Bus (æ‰€æœ‰äº‹ä»¶)
    â†“ è‡ªå‹•è¨‚é–± (subscribe to '*')
Audit Collector (çµ±ä¸€å…¥å£)
    â†“ æ™ºèƒ½è·¯ç”± (æ ¹æ“šäº‹ä»¶é¡å‹)
    â”œâ”€â†’ Auth Audit Service
    â”œâ”€â†’ Repository Audit Service
    â”œâ”€â†’ Issue Audit Service
    â””â”€â†’ Generic Audit Service
```

**ä¿®æ­£æ–¹æ¡ˆ**ï¼š
1. Audit Collector è¨‚é–± Event Bus æ‰€æœ‰äº‹ä»¶ (`'*'` pattern)
2. å¯¦ä½œ Event Type Router æ ¹æ“šäº‹ä»¶é¡å‹åˆ†ç™¼
3. ç§»é™¤ Consumer æ‰‹å‹•å‘¼å«ï¼Œæ”¹ç‚ºè‡ªå‹•è§¸ç™¼

#### ç¼ºå£ 2: ç§Ÿæˆ¶ä¸Šä¸‹æ–‡å‚³ééˆ

**ç¾ç‹€æ‹“æ’²**ï¼š
```
äº‹ä»¶ç™¼å‡ºæ™‚å¯èƒ½ç¼ºå°‘ tenantId
    â†“
Audit ç„¡æ³•åšç§Ÿæˆ¶éš”é›¢
    â†“
æŸ¥è©¢çµæœå¯èƒ½æ´©éœ²è·¨ç§Ÿæˆ¶è³‡æ–™
```

**ç†æƒ³æ‹“æ’²**ï¼š
```
[User Session] â†’ ç§Ÿæˆ¶ä¸Šä¸‹æ–‡ (TenantContext)
    â†“ è‡ªå‹•æ³¨å…¥
[Event Bus] â†’ äº‹ä»¶ metadata.tenantId (å¼·åˆ¶)
    â†“ è‡ªå‹•é©—è­‰
[Audit Collector] â†’ æå– tenantId (å¿…é ˆå­˜åœ¨)
    â†“ è‡ªå‹•éæ¿¾
[Audit Store] â†’ ç´¢å¼• tenant_id
    â†“ è‡ªå‹•æ³¨å…¥ where clause
[Query API] â†’ where('tenant_id', '==', currentTenant)
```

**ä¿®æ­£æ–¹æ¡ˆ**ï¼š
1. æ‰€æœ‰é ˜åŸŸäº‹ä»¶å¼·åˆ¶åŒ…å« `tenantId` (Event Bus å±¤é©—è­‰)
2. Audit Collector é©—è­‰ `tenantId` å­˜åœ¨ï¼Œå¦å‰‡æ‹’çµ•è¨˜éŒ„
3. æŸ¥è©¢ API è‡ªå‹•æ³¨å…¥ç§Ÿæˆ¶éæ¿¾æ¢ä»¶
4. è¶…ç´šç®¡ç†å“¡å¯é€šéç‰¹æ®Š flag è·¨ç§Ÿæˆ¶æŸ¥è©¢

#### ç¼ºå£ 3: æ¥­å‹™æ¨¡çµ„è¦†è“‹ç‡

**ç¾ç‹€æ‹“æ’²**ï¼š
```
âœ… Auth (100% è¦†è“‹)
    â”œâ”€ 11 å€‹äº‹ä»¶é¡å‹
    â””â”€ Auth Audit Service

âŒ Repository (0% è¦†è“‹)
âŒ Issue (0% è¦†è“‹)
âŒ PR (0% è¦†è“‹)
âŒ Organization (0% è¦†è“‹)
âŒ Team (0% è¦†è“‹)
```

**ç†æƒ³æ‹“æ’²**ï¼š
```
âœ… Auth (100%)
âœ… Repository (100%)
    â”œâ”€ repo.created
    â”œâ”€ repo.deleted
    â”œâ”€ repo.visibility_changed
    â”œâ”€ repo.settings_updated
    â””â”€ repo.collaborator_*

âœ… Issue (100%)
    â”œâ”€ issue.created
    â”œâ”€ issue.closed
    â”œâ”€ issue.assigned
    â””â”€ issue.labeled

âœ… PR (100%)
    â”œâ”€ pr.opened
    â”œâ”€ pr.merged
    â”œâ”€ pr.closed
    â””â”€ pr.reviewed

âœ… Organization (100%)
    â”œâ”€ org.member_added
    â”œâ”€ org.member_removed
    â””â”€ org.settings_updated
```

**ä¿®æ­£æ–¹æ¡ˆ**ï¼š
1. å®šç¾© Repository/Issue/PR/Organization é ˜åŸŸäº‹ä»¶
2. æ¥­å‹™æ¨¡çµ„ç™¼å‡ºäº‹ä»¶æ™‚é™„å¸¶å®Œæ•´å…ƒæ•¸æ“š
3. Audit Collector è‡ªå‹•è¨‚é–±æ–°äº‹ä»¶é¡å‹
4. åˆ†éšæ®µå¯¦æ–½ï¼ˆP1: Repo/Issue, P2: PR/Orgï¼‰

#### ç¼ºå£ 4: å…¨åŸŸç³»çµ±æ•´åˆ

**ç¾ç‹€æ‹“æ’²**ï¼š
```
[Audit Log] â†â”€æœªæ•´åˆâ”€â†’ [Notification]
[Audit Log] â†â”€æœªæ•´åˆâ”€â†’ [Permission System]
[Audit Log] â†â”€æœªæ•´åˆâ”€â†’ [Analytics]
[Audit Log] â†â”€æœªæ•´åˆâ”€â†’ [Rate Limiting]
[Audit Log] â†â”€æœªæ•´åˆâ”€â†’ [Billing]
```

**ç†æƒ³æ‹“æ’²**ï¼š
```
[Audit Log] â”€é›™å‘æ•´åˆâ†’ [Notification]
    â”œâ”€â†’ CRITICAL event â†’ ç™¼é€å‘Šè­¦
    â””â”€â† Notification sent â†’ è¨˜éŒ„é€šçŸ¥äº‹ä»¶

[Audit Log] â”€é›™å‘æ•´åˆâ†’ [Permission System]
    â”œâ”€â†’ æˆæ¬Šæ±ºç­– â†’ è¨˜éŒ„ decision (allow/deny)
    â””â”€â† Permission changed â†’ è§¸ç™¼å¯©è¨ˆ

[Audit Log] â”€å–®å‘è¼¸å‡ºâ†’ [Analytics]
    â””â”€â†’ æä¾›çµ±è¨ˆè³‡æ–™ (event trends, category distribution)

[Audit Log] â”€å–®å‘è¼¸å…¥â† [Rate Limiting]
    â””â”€â† Limit exceeded â†’ è¨˜éŒ„é™æµäº‹ä»¶

[Audit Log] â”€å–®å‘è¼¸å…¥â† [Billing]
    â””â”€â† Subscription changed â†’ è¨˜éŒ„è¨ˆè²»æ“ä½œ
```

**ä¿®æ­£æ–¹æ¡ˆ**ï¼š
1. **Phase 1 (P1)**: æ•´åˆ Notification (CRITICAL event å‘Šè­¦)
2. **Phase 2 (P1)**: æ•´åˆ Permission System (æˆæ¬Šæ±ºç­–è¿½è¹¤)
3. **Phase 3 (P2)**: æ•´åˆ Analytics (çµ±è¨ˆè³‡æ–™æä¾›)
4. **Phase 4 (P2)**: æ•´åˆ Rate Limiting/Billing (äº‹ä»¶è¨˜éŒ„)

### 4.3 æŒä¹…åŒ–å±¤æ‹“æ’²å°é½Š

**ç¾ç‹€æ‹“æ’²**ï¼š
```
[Audit Collector]
    â†“
[In-Memory Store]
    â”œâ”€ æœ€å¤š 1000 ç­†äº‹ä»¶
    â””â”€ é‡å•Ÿéºå¤±
```

**ç†æƒ³æ‹“æ’² (Multi-Tier Storage Strategy)**ï¼š
```
[Audit Collector]
    â†“
[Storage Strategy Interface] (æŠ½è±¡å±¤)
    â”œâ”€â†’ [Hot Tier] (In-Memory / Redis)
    â”‚    â”œâ”€ ä¿ç•™: 24 å°æ™‚
    â”‚    â”œâ”€ ç”¨é€”: å³æ™‚æŸ¥è©¢ã€Dashboard
    â”‚    â””â”€ æ·˜æ±°: FIFO ç­–ç•¥
    â”‚
    â”œâ”€â†’ [Warm Tier] (Firestore)
    â”‚    â”œâ”€ ä¿ç•™: 90 å¤©
    â”‚    â”œâ”€ ç”¨é€”: ä¸€èˆ¬æŸ¥è©¢ã€å°å‡º
    â”‚    â”œâ”€ ç´¢å¼•: timestamp, tenant_id, category, level
    â”‚    â””â”€ Collection: audit_logs (ç§Ÿæˆ¶éš”é›¢)
    â”‚
    â””â”€â†’ [Cold Tier] (Cloud Storage)
         â”œâ”€ ä¿ç•™: 7 å¹´
         â”œâ”€ ç”¨é€”: åˆè¦æ­¸æª”
         â”œâ”€ æ ¼å¼: Parquet (å£“ç¸®)
         â””â”€ è·¯å¾‘: gs://bucket/tenant_id/year/month/audit_logs.parquet
```

**ä¿®æ­£æ–¹æ¡ˆ**ï¼š
1. å®šç¾© Storage Strategy Interface (æŠ½è±¡å±¤)
2. å¯¦ä½œ Firestore Storage Strategy (Warm Tier - P0)
3. å¯¦ä½œ Cloud Storage Strategy (Cold Tier - P2)
4. å¯¦ä½œ Tiering Policy (è‡ªå‹•æ·˜æ±°èˆ‡æ­¸æª” - P1)

---

## ğŸ›¤ï¸ Part V: å¯¦æ–½è·¯å¾‘èˆ‡éšæ®µè¦åŠƒ

### 5.1 Phase 1: æ ¸å¿ƒæ‹“æ’²è£œå¼· (P0 - Critical)

**ç›®æ¨™**: å»ºç«‹å®Œæ•´çš„ Audit ç³»çµ±éª¨æ¶ï¼Œç¢ºä¿ç³»çµ±å¯ç”¨æ€§

#### Task 1.1: Firestore æŒä¹…åŒ–å±¤å¯¦ä½œ

**ç³»çµ±äº¤äº’èª¿æ•´**ï¼š
```
[Before]
Audit Collector â†’ In-Memory Store (åƒ…)

[After]
Audit Collector â†’ [Storage Strategy Router]
                      â”œâ”€â†’ In-Memory (Hot Tier)
                      â””â”€â†’ Firestore (Warm Tier)
```

**è¨­è¨ˆæ±ºç­–é»**ï¼š
- **å¯«å…¥ç­–ç•¥**: å³æ™‚å¯«å…¥ (In-Memory) + éåŒæ­¥æ‰¹æ¬¡å¯«å…¥ (Firestore)
- **Collection è¨­è¨ˆ**: å–® Collection å¤šç§Ÿæˆ¶ (`audit_logs`)
- **ç´¢å¼•ç­–ç•¥**: 
  - è¤‡åˆç´¢å¼•: (tenant_id, timestamp DESC)
  - è¤‡åˆç´¢å¼•: (tenant_id, category, timestamp DESC)
  - è¤‡åˆç´¢å¼•: (tenant_id, level, timestamp DESC)
- **ä¿ç•™ç­–ç•¥**: Firestore ä¿ç•™ 90 å¤©ï¼Œè¶…éè‡ªå‹•æ­¸æª”åˆ° Cloud Storage

#### Task 1.2: ç§Ÿæˆ¶éš”é›¢æ©Ÿåˆ¶å¼·åŒ–

**ä¸Šä¸‹æ–‡å‚³ééˆå®Œæ•´åŒ–**ï¼š
```
[User Session / Service Account]
    â†“ å»ºç«‹ç§Ÿæˆ¶ä¸Šä¸‹æ–‡
[Tenant Context Service]
    â†“ æ³¨å…¥åˆ°æ‰€æœ‰æ“ä½œ
[Event Bus] â†’ äº‹ä»¶å¼·åˆ¶åŒ…å« metadata.tenantId
    â†“ è‡ªå‹•é©—è­‰
[Audit Collector] â†’ é©—è­‰ tenantId å­˜åœ¨
    â†“ æ‹’çµ•ç„¡ tenantId äº‹ä»¶
[Audit Store] â†’ ç´¢å¼• tenant_id
    â†“ è‡ªå‹•éæ¿¾
[Query API] â†’ where('tenant_id', '==', currentTenant)
    â†“ è¶…ç´šç®¡ç†å“¡ä¾‹å¤–
[Query Results] â†’ åƒ…è¿”å›ç•¶å‰ç§Ÿæˆ¶è³‡æ–™
```

**å¯¦æ–½è¦é»**ï¼š
1. Tenant Context Service æä¾›å…¨åŸŸç§Ÿæˆ¶ä¸Šä¸‹æ–‡
2. Event Bus ä¸­ä»‹è»Ÿé«”é©—è­‰æ‰€æœ‰äº‹ä»¶åŒ…å« tenantId
3. Audit Collector æ‹’çµ•è¨˜éŒ„ç„¡ tenantId äº‹ä»¶
4. Query API è‡ªå‹•æ³¨å…¥ `where('tenant_id', '==', currentTenant)` æ¢ä»¶
5. è¶…ç´šç®¡ç†å“¡é€šéç‰¹æ®Š flag `allowCrossTenant: true` è·¨ç§Ÿæˆ¶æŸ¥è©¢

#### Task 1.3: Event Bus è‡ªå‹•è¨‚é–±

**æ¶æ§‹èª¿æ•´**ï¼š
```
[Before]
Business Module â†’ Event Bus â†’ Specific Consumer
                                    â†“ æ‰‹å‹•å‘¼å«
                               Audit Service

[After]
Business Module â†’ Event Bus â†’ [All Consumers]
                      â†“ è‡ªå‹•è¨‚é–± '*'
                 Audit Collector (å…¨åŸŸè¨‚é–±)
                      â†“ Event Type Router
                 [ç›¸æ‡‰ Audit Service]
```

**å¯¦æ–½è¦é»**ï¼š
1. Audit Collector è¨‚é–± Event Bus æ‰€æœ‰äº‹ä»¶ (`subscribe('*')`)
2. å¯¦ä½œ Event Type Router æ ¹æ“šäº‹ä»¶é¡å‹è·¯ç”±
3. äº‹ä»¶éæ¿¾å™¨æ’é™¤éå¯©è¨ˆäº‹ä»¶ (å¦‚ UI å±¤äº‹ä»¶)
4. ä¿æŒå‘å¾Œå…¼å®¹ï¼ˆæ‰‹å‹•å‘¼å«ä»å¯é‹ä½œï¼‰

### 5.2 Phase 2: æ¥­å‹™é ˜åŸŸè¦†è“‹ (P1 - High)

**ç›®æ¨™**: æ“´å±•å¯©è¨ˆè¦†è“‹è‡³æ‰€æœ‰æ ¸å¿ƒæ¥­å‹™æ¨¡çµ„

#### Task 2.1: Repository Events å¯©è¨ˆ

**äº‹ä»¶å®šç¾©**ï¼š
```
repo.created
    â”œâ”€ Actor: å»ºç«‹è€…
    â”œâ”€ Resource: repo_id
    â”œâ”€ Metadata: visibility (public/private), description
    â””â”€ Level: INFO

repo.deleted
    â”œâ”€ Actor: åˆªé™¤è€…
    â”œâ”€ Resource: repo_id
    â”œâ”€ Metadata: force_delete flag
    â””â”€ Level: WARNING

repo.visibility_changed
    â”œâ”€ Actor: è®Šæ›´è€…
    â”œâ”€ Resource: repo_id
    â”œâ”€ Change: public â†’ private or private â†’ public
    â””â”€ Level: WARNING (è‹¥ private â†’ public, CRITICAL)

repo.settings_updated
    â”œâ”€ Actor: è®Šæ›´è€…
    â”œâ”€ Resource: repo_id
    â”œâ”€ Change: settings diff
    â””â”€ Level: INFO

repo.collaborator_added
    â”œâ”€ Actor: æ–°å¢è€…
    â”œâ”€ Resource: repo_id
    â”œâ”€ Target: collaborator_user_id
    â””â”€ Level: INFO

repo.collaborator_removed
    â”œâ”€ Actor: ç§»é™¤è€…
    â”œâ”€ Resource: repo_id
    â”œâ”€ Target: collaborator_user_id
    â””â”€ Level: WARNING

repo.permission_changed
    â”œâ”€ Actor: è®Šæ›´è€…
    â”œâ”€ Resource: repo_id
    â”œâ”€ Target: collaborator_user_id
    â”œâ”€ Change: read â†’ write or write â†’ admin
    â””â”€ Level: WARNING (è‹¥ â†’ admin, CRITICAL)
```

**äº¤äº’æ‹“æ’²**ï¼š
```
Repository Service (æ¥­å‹™æœå‹™)
    â†“ ç™¼å‡º repo.* äº‹ä»¶
Event Bus
    â†“ è‡ªå‹•è·¯ç”±
Audit Collector
    â†“ äº‹ä»¶é¡å‹ = 'repo.*'
Repository Audit Service
    â†“ åˆ†é¡ç‚º DATA_MODIFICATION / AUTHORIZATION
Audit Log Store
```

#### Task 2.2: Issue/PR Events å¯©è¨ˆ

**äº‹ä»¶å®šç¾©**ï¼š
```
[Issue Events]
issue.created, issue.closed, issue.reopened
issue.assigned, issue.unassigned
issue.labeled, issue.unlabeled
issue.commented

[PR Events]
pr.opened, pr.merged, pr.closed, pr.reopened
pr.review_requested, pr.reviewed
pr.approved, pr.changes_requested
pr.committed
```

#### Task 2.3: Organization Events å¯©è¨ˆ

**äº‹ä»¶å®šç¾©**ï¼š
```
org.member_added, org.member_removed
org.team_created, org.team_deleted
org.settings_updated
org.billing_changed
org.webhook_added, org.webhook_deleted
```

### 5.3 Phase 3: æ©«åˆ‡æ•´åˆ (P1 - High)

**ç›®æ¨™**: å°‡ Audit èˆ‡å…¶ä»–å…¨åŸŸç³»çµ±æ•´åˆ

#### Task 3.1: Permission System Integration

**äº¤äº’æ¨¡å¼**ï¼š
```
[Permission Service] â†’ checkPermission(actor, resource, action)
    â†“ è¨ˆç®—æˆæ¬Šæ±ºç­–
[Decision Point]
    â”œâ”€â†’ Allow â†’ ç™¼å‡º permission.check.allowed äº‹ä»¶
    â””â”€â†’ Deny â†’ ç™¼å‡º permission.check.denied äº‹ä»¶
    â†“ è‡ªå‹•è¨‚é–±
[Audit Collector] â†’ è¨˜éŒ„æˆæ¬Šæ±ºç­–
    â”œâ”€ Actor: èª°ç™¼èµ·è«‹æ±‚
    â”œâ”€ Resource: ç›®æ¨™è³‡æº
    â”œâ”€ Action: è«‹æ±‚çš„æ“ä½œ
    â”œâ”€ Decision: Allow / Deny
    â””â”€ Reason: æ±ºç­–åŸå›  (è¦å‰‡åŒ¹é…çµæœ)
```

**ç´šåˆ¥åˆ¤å®š**ï¼š
- æˆåŠŸæˆæ¬Š â†’ INFO
- æ‹’çµ•æˆæ¬Š â†’ WARNING
- ç•°å¸¸æˆæ¬Šæ¨¡å¼ â†’ CRITICAL (å¦‚é »ç¹æ‹’çµ•åŒä¸€è³‡æº)

#### Task 3.2: Notification System Integration

**å‘Šè­¦è§¸ç™¼è¦å‰‡**ï¼š
```
[Audit Log Service] â†’ æª¢æ¸¬ CRITICAL äº‹ä»¶
    â†“ è‡ªå‹•è§¸ç™¼
[Notification Service] â†’ ç™¼é€å‘Šè­¦
    â”œâ”€â†’ å®‰å…¨åœ˜éšŠ (SECURITY category)
    â”œâ”€â†’ åˆè¦åœ˜éšŠ (COMPLIANCE category)
    â””â”€â†’ ç³»çµ±ç®¡ç†å“¡ (SYSTEM_CONFIGURATION category)
```

**å‘Šè­¦é€šé“**ï¼š
- Email (é«˜å„ªå…ˆç´šï¼Œç«‹å³ç™¼é€)
- Slack/Teams (å³æ™‚é€šçŸ¥ï¼Œå¯é…ç½®)
- In-App Notification (Dashboard æç¤º)

#### Task 3.3: Analytics Integration

**çµ±è¨ˆç¶­åº¦**ï¼š
```
[Audit Log Service] â†’ æä¾›çµ±è¨ˆ API
    â†“ è³‡æ–™èšåˆ
[Analytics Service] â†’ åˆ†æè™•ç†
    â”œâ”€â†’ äº‹ä»¶è¶¨å‹¢ (æ™‚é–“åºåˆ—åœ–)
    â”œâ”€â†’ é¡åˆ¥åˆ†ä½ˆ (åœ“é¤…åœ–)
    â”œâ”€â†’ é«˜é¢¨éšªä½¿ç”¨è€… (Top N æ’è¡Œ)
    â””â”€â†’ ç•°å¸¸æ¨¡å¼æª¢æ¸¬ (æ©Ÿå™¨å­¸ç¿’)
```

### 5.4 Phase 4: åˆè¦èˆ‡æ²»ç† (P2 - Medium)

**ç›®æ¨™**: æ»¿è¶³æ³•è¦èˆ‡ä¼æ¥­æ²»ç†éœ€æ±‚

#### Task 4.1: Compliance Reporting

**å ±å‘Šé¡å‹**ï¼š
- **å­˜å–å ±å‘Š** (Access Report): èª°å­˜å–äº†å“ªäº›è³‡æº
- **è®Šæ›´å ±å‘Š** (Change Report): ç³»çµ±é…ç½®è®Šæ›´æ­·å²
- **å®‰å…¨å ±å‘Š** (Security Report): å®‰å…¨äº‹ä»¶å½™æ•´
- **åˆè¦å ±å‘Š** (Compliance Report): ç¬¦åˆç‰¹å®šæ³•è¦è¦æ±‚ (GDPR, SOC2)

**å°å‡ºæ ¼å¼**ï¼š
- JSON (ç¨‹å¼åŒ–è™•ç†)
- CSV (Excel åˆ†æ)
- PDF (åˆè¦æ­¸æª”ï¼ŒåŒ…å«çµ±è¨ˆåœ–è¡¨)

#### Task 4.2: Audit Log Retention Policy

**Multi-Tier Storage Strategy**ï¼š
```
[Hot Tier] (In-Memory / Redis)
    â”œâ”€ ä¿ç•™: 24 å°æ™‚
    â”œâ”€ ç”¨é€”: å³æ™‚æŸ¥è©¢ã€Dashboard
    â””â”€ æ·˜æ±°: FIFO ç­–ç•¥

[Warm Tier] (Firestore)
    â”œâ”€ ä¿ç•™: 90 å¤©
    â”œâ”€ ç”¨é€”: ä¸€èˆ¬æŸ¥è©¢ã€å°å‡º
    â””â”€ æ·˜æ±°: è‡ªå‹•æ­¸æª”åˆ° Cold Tier

[Cold Tier] (Cloud Storage)
    â”œâ”€ ä¿ç•™: 7 å¹´
    â”œâ”€ ç”¨é€”: åˆè¦æ­¸æª”
    â””â”€ æ ¼å¼: Parquet (å£“ç¸®ï¼Œç¯€çœæˆæœ¬)
```

#### Task 4.3: Audit Review Workflow

**å¯©æŸ¥æµç¨‹**ï¼š
```
[é«˜é¢¨éšªäº‹ä»¶è§¸ç™¼] â†’ requiresReview = true
    â†“ è‡ªå‹•é€šçŸ¥
[å¯©æŸ¥è€…] (Security Team / Compliance Officer)
    â†“ æª¢è¦–
[Audit Viewer UI] â†’ é¡¯ç¤ºäº‹ä»¶è©³æƒ…
    â†“ æ±ºç­–
[Review Decision]
    â”œâ”€â†’ Approve â†’ reviewed_at, reviewed_by, notes
    â”œâ”€â†’ Investigate â†’ create_incident_ticket (æ•´åˆ Issue Tracker)
    â””â”€â†’ Escalate â†’ notify_senior_management
```

---

## ğŸ“Š Part VI: ç³»çµ±å¥åº·åº¦è©•ä¼°èˆ‡è¿½è¹¤

### 6.1 å®Œæˆåº¦è¿½è¹¤çŸ©é™£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Global Audit Log ç³»çµ±å®Œæˆåº¦è¿½è¹¤çŸ©é™£               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¶­åº¦           â”‚ ç›®æ¨™ â”‚ ç•¶å‰ â”‚ å·®è· â”‚ å„ªå…ˆç´š â”‚ é è¨ˆå®Œæˆ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ ¸å¿ƒæ¨¡å‹        â”‚ 100% â”‚ 100% â”‚  0%  â”‚   -   â”‚    âœ…    â”‚
â”‚ åˆ†é¡è¦å‰‡        â”‚ 100% â”‚ 100% â”‚  0%  â”‚   -   â”‚    âœ…    â”‚
â”‚ äº‹ä»¶æ”å–        â”‚ 100% â”‚  40% â”‚ 60%  â”‚  P1   â”‚ Week 2  â”‚
â”‚ è‡ªå‹•è¨‚é–±        â”‚ 100% â”‚  30% â”‚ 70%  â”‚  P0   â”‚ Week 1  â”‚
â”‚ å„²å­˜å±¤          â”‚ 100% â”‚  50% â”‚ 50%  â”‚  P0   â”‚ Week 1  â”‚
â”‚ ç§Ÿæˆ¶éš”é›¢        â”‚ 100% â”‚  40% â”‚ 60%  â”‚  P0   â”‚ Week 1  â”‚
â”‚ æŸ¥è©¢ API        â”‚ 100% â”‚  70% â”‚ 30%  â”‚  P1   â”‚ Week 2  â”‚
â”‚ å°å‡ºåŠŸèƒ½        â”‚ 100% â”‚  60% â”‚ 40%  â”‚  P2   â”‚ Week 3  â”‚
â”‚ å¯©æŸ¥å·¥ä½œæµ      â”‚ 100% â”‚  50% â”‚ 50%  â”‚  P2   â”‚ Week 4  â”‚
â”‚ å‘Šè­¦æ•´åˆ        â”‚ 100% â”‚   0% â”‚ 100% â”‚  P1   â”‚ Week 2  â”‚
â”‚ æ¬Šé™æ•´åˆ        â”‚ 100% â”‚   0% â”‚ 100% â”‚  P1   â”‚ Week 2  â”‚
â”‚ Analytics æ•´åˆ  â”‚ 100% â”‚   0% â”‚ 100% â”‚  P2   â”‚ Week 4  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•´é«”å®Œæˆåº¦      â”‚ 100% â”‚  48% â”‚ 52%  â”‚   -   â”‚ Month 1 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æ‹“æ’²ä¸€è‡´æ€§æª¢æŸ¥æ¸…å–®

**âœ… å·²é”æˆçš„æ‹“æ’²ä¸€è‡´æ€§**ï¼š
- âœ… Event Bus â†’ Audit Collector è¨‚é–±æ¨¡å¼å·²å»ºç«‹
- âœ… Audit Collector â†’ Classification è™•ç†æµç¨‹å®Œæ•´
- âœ… 8 categories / 4 levels åˆ†é¡é«”ç³»ä¸€è‡´
- âœ… Auth é ˜åŸŸäº‹ä»¶å®Œæ•´è¦†è“‹
- âœ… Audit Event Model æ¨™æº–åŒ–

**âš ï¸ éœ€è£œå¼·çš„æ‹“æ’²ä¸€è‡´æ€§**ï¼š
- âš ï¸ è‡ªå‹•è¨‚é–±æ©Ÿåˆ¶ (éœ€å¾æ‰‹å‹•æ”¹ç‚ºè‡ªå‹•)
- âš ï¸ ç§Ÿæˆ¶éš”é›¢ (éœ€å¼·åŒ–æŸ¥è©¢å±¤éæ¿¾)
- âš ï¸ æŒä¹…åŒ–å±¤ (éœ€å¯¦ä½œ Firestore + Cloud Storage)
- âš ï¸ æ¥­å‹™è¦†è“‹ (éœ€æ“´å±•åˆ° Repo/Issue/PR)

**âŒ å°šæœªå¯¦ç¾çš„æ‹“æ’²ä¸€è‡´æ€§**ï¼š
- âŒ å…¨åŸŸç³»çµ±æ•´åˆ (Notification, Permission, Analytics)
- âŒ Multi-Tier Storage Strategy
- âŒ Compliance Reporting
- âŒ Audit Review Workflow å®Œæ•´æµç¨‹

---

## ğŸ¯ Part VII: ä¸‹ä¸€æ­¥è¡Œå‹•å»ºè­°

### 7.1 ç«‹å³åŸ·è¡Œ (P0 - Week 1)

**ç›®æ¨™**: è£œå¼·æ ¸å¿ƒæ‹“æ’²ï¼Œç¢ºä¿ç³»çµ±å¯ç”¨æ€§

1. **å¯¦ä½œ Firestore æŒä¹…åŒ–å±¤**
   - å®šç¾© Storage Strategy Interface
   - å¯¦ä½œ Firestore Storage Strategy
   - å»ºç«‹ç´¢å¼• (tenant_id, timestamp, category, level)
   - å¯¦ä½œæ‰¹æ¬¡å¯«å…¥æ©Ÿåˆ¶

2. **å¼·åŒ–ç§Ÿæˆ¶éš”é›¢æ©Ÿåˆ¶**
   - Tenant Context Service å…¨åŸŸå¯ç”¨
   - Event Bus é©—è­‰æ‰€æœ‰äº‹ä»¶åŒ…å« tenantId
   - Audit Collector æ‹’çµ•ç„¡ tenantId äº‹ä»¶
   - Query API è‡ªå‹•æ³¨å…¥ç§Ÿæˆ¶éæ¿¾æ¢ä»¶

3. **å¯¦ä½œ Event Bus è‡ªå‹•è¨‚é–±**
   - Audit Collector è¨‚é–±æ‰€æœ‰äº‹ä»¶ (`'*'`)
   - Event Type Router å¯¦ä½œ
   - äº‹ä»¶éæ¿¾å™¨æ’é™¤éå¯©è¨ˆäº‹ä»¶

### 7.2 çŸ­æœŸè¦åŠƒ (P1 - Week 2-3)

**ç›®æ¨™**: æ“´å±•æ¥­å‹™è¦†è“‹èˆ‡ç³»çµ±æ•´åˆ

4. **æ“´å±•æ¥­å‹™é ˜åŸŸè¦†è“‹**
   - å®šç¾© Repository/Issue/PR Events
   - æ¥­å‹™æ¨¡çµ„ç™¼å‡ºäº‹ä»¶
   - Audit Collector è‡ªå‹•è¨‚é–±æ–°äº‹ä»¶

5. **æ•´åˆ Permission System**
   - è¨˜éŒ„æˆæ¬Šæ±ºç­– (allow/deny)
   - è¿½è¹¤æ¬Šé™è®Šæ›´
   - æª¢æ¸¬ç•°å¸¸æˆæ¬Šæ¨¡å¼

6. **æ•´åˆ Notification System**
   - CRITICAL äº‹ä»¶è‡ªå‹•å‘Šè­¦
   - å®‰å…¨/åˆè¦äº‹ä»¶é€šçŸ¥
   - å¤šé€šé“åˆ†ç™¼ (Email/Slack/In-App)

### 7.3 ä¸­æœŸè¦åŠƒ (P2 - Week 4+)

**ç›®æ¨™**: æ»¿è¶³åˆè¦èˆ‡æ²»ç†éœ€æ±‚

7. **å¯¦ä½œ Compliance Reporting**
   - CSV/PDF å°å‡º
   - å®šæœŸå ±å‘Šæ’ç¨‹
   - åˆè¦æ¨¡æ¿

8. **å¯¦ä½œ Audit Review Workflow**
   - å¯©æŸ¥è€…åˆ†é…
   - å¯©æŸ¥æ±ºç­–è¿½è¹¤
   - å‡ç´šæµç¨‹

9. **æ•´åˆ Analytics**
   - çµ±è¨ˆè³‡æ–™æä¾› API
   - è¶¨å‹¢åˆ†æ
   - ç•°å¸¸æ¨¡å¼æª¢æ¸¬

---

## ğŸ“ Part VIII: ç¸½çµèˆ‡æŒçºŒè¿½è¹¤

### 8.1 æ ¸å¿ƒç™¼ç¾

1. **æ‹“æ’²å®Œæ•´æ€§**: åŸºç¤æ¶æ§‹ (Phase 7A+7B) å·²å»ºç«‹ï¼Œ8-Layer Topology å®šç¾©æ¸…æ™°ï¼Œä½†æ©«å‘æ•´åˆèˆ‡è‡ªå‹•åŒ–ç¨‹åº¦ä¸è¶³
2. **æ©«åˆ‡è²«ç©¿**: Audit ä½œç‚ºæ©«åˆ‡é—œæ³¨é»çš„è¨­è¨ˆç†å¿µæ­£ç¢ºï¼ŒEvent-Driven ç‚ºæœ€ä½³å¯¦è¸ï¼Œä½†åŸ·è¡Œå±¤ç¼ºä¹è‡ªå‹•åŒ–è¨‚é–±æ©Ÿåˆ¶
3. **è½å·®ä¿®æ­£**: ä¸»è¦ç¼ºå£åœ¨æŒä¹…åŒ– (P0)ã€ç§Ÿæˆ¶éš”é›¢ (P0)ã€æ¥­å‹™è¦†è“‹ (P1)ã€ç³»çµ±æ•´åˆ (P1)
4. **å¯¦æ–½è·¯å¾‘**: 4 éšæ®µè¦åŠƒæ¸…æ™°ï¼Œå„ªå…ˆç´šæ˜ç¢º (P0/P1/P2)

### 8.2 è¨­è¨ˆåŸå‰‡é©—è­‰

**âœ… ç¬¦åˆ GitHub å…¨åŸŸç³»çµ±è¨­è¨ˆåŸå‰‡**ï¼š
- âœ… **è§£è€¦**: Event-Driven ç¢ºä¿æ¥­å‹™èˆ‡å¯©è¨ˆå®Œå…¨è§£è€¦
- âœ… **ç§Ÿæˆ¶æ„ŸçŸ¥**: æ‰€æœ‰çµ„ä»¶å…§å»ºç§Ÿæˆ¶éš”é›¢æ©Ÿåˆ¶ (éœ€å¼·åŒ–)
- âœ… **å¯æ“´å±•**: æ¨¡çµ„åŒ–è¨­è¨ˆæ”¯æ´æ–°äº‹ä»¶é¡å‹èˆ‡æ–°æ¥­å‹™æ¨¡çµ„
- âœ… **å¯è§€æ¸¬**: å®Œæ•´çš„å…ƒæ•¸æ“šæ”¯æ´è¿½è¹¤èˆ‡åˆ†æ
- âœ… **å®¹éŒ¯**: DLQ æ©Ÿåˆ¶ç¢ºä¿äº‹ä»¶ä¸éºå¤±
- âœ… **å®‰å…¨**: å¤šå±¤æ¬Šé™é©—è­‰ã€ç§Ÿæˆ¶éš”é›¢ã€æ•æ„Ÿè³‡æ–™ä¿è­·

### 8.3 æŒçºŒè¿½è¹¤æ©Ÿåˆ¶

**æ¯é€±æª¢è¦–**ï¼š
- æ›´æ–°å®Œæˆåº¦è¿½è¹¤çŸ©é™£
- é©—è­‰æ‹“æ’²ä¸€è‡´æ€§
- èª¿æ•´å¯¦æ–½å„ªå…ˆç´š

**æ¯éšæ®µæª¢è¦–**ï¼š
- å…¨é¢æ‹“æ’²å°é½Šé©—è­‰
- ç³»çµ±å¥åº·åº¦è©•ä¼°
- ä¸‹ä¸€éšæ®µè¦åŠƒèª¿æ•´

**é—œéµæŒ‡æ¨™**ï¼š
- æ¥­å‹™è¦†è“‹ç‡ (ç›®æ¨™ 100%)
- è‡ªå‹•åŒ–ç¨‹åº¦ (ç›®æ¨™ 100% è‡ªå‹•è¨‚é–±)
- ç§Ÿæˆ¶éš”é›¢å®Œæ•´æ€§ (ç›®æ¨™ 100% å¼·åˆ¶éš”é›¢)
- ç³»çµ±æ•´åˆåº¦ (ç›®æ¨™æ•´åˆ 5+ å…¨åŸŸç³»çµ±)

---

**æ–‡ä»¶ç¶­è­·**: éš¨å¯¦æ–½é€²å±•åŒæ­¥æ›´æ–°  
**å¯©æŸ¥é€±æœŸ**: æ¯å®Œæˆä¸€å€‹éšæ®µå¾Œæª¢è¦–æ‹“æ’²ä¸€è‡´æ€§  
**ä¸‹ä¸€ç‰ˆæœ¬**: v2.0.0 (é è¨ˆ Phase 1 å®Œæˆå¾Œç™¼å¸ƒ)

---

## é™„éŒ„ A: äº‹ä»¶é¡å‹å®Œæ•´æ¸…å–®

### A.1 å·²å®šç¾©äº‹ä»¶ (Phase 7A)

**Auth Events** (11 å€‹):
```
auth.user.login
auth.user.logout
auth.login.failed
auth.password.changed
auth.mfa.enabled
auth.mfa.disabled
auth.token.refreshed
auth.session.expired
auth.permission.changed
auth.role.changed
auth.email.verified
```

### A.2 å¾…å®šç¾©äº‹ä»¶ (Phase 2)

**Repository Events** (7 å€‹):
```
repo.created
repo.deleted
repo.visibility_changed
repo.settings_updated
repo.collaborator_added
repo.collaborator_removed
repo.permission_changed
```

**Issue Events** (8 å€‹):
```
issue.created
issue.closed
issue.reopened
issue.assigned
issue.unassigned
issue.labeled
issue.unlabeled
issue.commented
```

**PR Events** (10 å€‹):
```
pr.opened
pr.merged
pr.closed
pr.reopened
pr.review_requested
pr.reviewed
pr.approved
pr.changes_requested
pr.committed
pr.conflict_detected
```

**Organization Events** (8 å€‹):
```
org.member_added
org.member_removed
org.team_created
org.team_deleted
org.settings_updated
org.billing_changed
org.webhook_added
org.webhook_deleted
```

---

## é™„éŒ„ B: æ‹“æ’²åœ–ç´¢å¼•

**åœ– 1**: ç³»çµ±å±¤ç´šå®šä½ (3-Tier Architecture)  
**åœ– 2**: 8-Layer Topology å®Œæ•´æµç¨‹  
**åœ– 3**: Event Bus â†’ Audit Collector äº¤äº’æ¨¡å¼  
**åœ– 4**: Classification Engine è™•ç†æµç¨‹  
**åœ– 5**: Multi-Tier Storage Strategy  
**åœ– 6**: å…¨åŸŸç³»çµ±æ•´åˆæ‹“æ’²  
**åœ– 7**: ç§Ÿæˆ¶ä¸Šä¸‹æ–‡å‚³ééˆ  
**åœ– 8**: æ©«åˆ‡é»æ³¨å…¥æ–¹å¼æ¯”è¼ƒ  

---

**æ–‡ä»¶çµæŸ**
